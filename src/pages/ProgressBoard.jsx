import React from "react";
import "../styles/Responsive.css";

export default function ProgressBoard({ jobs }) {
  const steps = ["Sales", "Warehouse", "Production", "QC", "Account"];

  const getStatusColor = (step, job) => {
    if (!job.status) return "#e5e7eb"; // ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏£‡∏¥‡πà‡∏°

    const status = job.status;
    const currentStep = job.currentStep;

    switch (step) {
      case "Sales":
        return job.product_name && job.po_number && job.volume && job.customer
          ? "#4ade80" // ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß
          : "#e5e7eb"; // ‡πÄ‡∏ó‡∏≤

      case "Warehouse":
        if (
          status.warehouse === "‡πÄ‡∏ö‡∏¥‡∏Å‡πÄ‡∏™‡∏£‡πá‡∏à" ||
          status.warehouse === "‡∏°‡∏µ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏£‡∏ö‡∏ï‡∏≤‡∏°‡∏à‡∏≥‡∏ô‡∏ß‡∏ô"
        )
          return "#4ade80";
        return "#e5e7eb";

      case "Production":
        // ‚úÖ ‡∏ú‡∏•‡∏¥‡∏ï‡πÄ‡∏™‡∏£‡πá‡∏à
        if (status.production === "‡∏ú‡∏•‡∏¥‡∏ï‡πÄ‡∏™‡∏£‡πá‡∏à") {
          return "#4ade80";
        }

        // ‚úÖ Warehouse ‡∏°‡∏µ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏£‡∏ö ‡πÅ‡∏•‡∏∞ currentStep ‡πÑ‡∏õ‡∏ñ‡∏∂‡∏á QC/‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å‡∏ô‡∏±‡πâ‡∏ô
        if (
          status.warehouse === "‡∏°‡∏µ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏£‡∏ö‡∏ï‡∏≤‡∏°‡∏à‡∏≥‡∏ô‡∏ß‡∏ô" &&
          ["QC", "Account", "Completed"].includes(currentStep)
        ) {
          return "#4ade80";
        }

        // ‚úÖ ‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏ó‡∏≥
        if (
          status.warehouse === "‡πÄ‡∏ö‡∏¥‡∏Å‡πÄ‡∏™‡∏£‡πá‡∏à" &&
          ["‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ú‡∏•‡∏¥‡∏ï", "‡∏£‡∏≠‡∏ú‡∏•‡∏ï‡∏£‡∏ß‡∏à", "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏£‡∏£‡∏à‡∏∏"].includes(status.production)
        ) {
          return "#facc15";
        }

        // ‚úÖ QC ‡∏ú‡πà‡∏≤‡∏ô‡πÅ‡∏•‡πâ‡∏ß ‡πÅ‡∏ï‡πà production ‡∏¢‡∏±‡∏á‡∏ö‡∏£‡∏£‡∏à‡∏∏‡∏≠‡∏¢‡∏π‡πà
        if (
          status.qc_inspection === "‡∏ï‡∏£‡∏ß‡∏à‡∏ú‡πà‡∏≤‡∏ô‡πÅ‡∏•‡πâ‡∏ß" &&
          status.production === "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏£‡∏£‡∏à‡∏∏"
        ) {
          return "#facc15";
        }

        // ‚ùå ‡∏ñ‡πâ‡∏≤ QC ‡πÑ‡∏°‡πà‡∏ú‡πà‡∏≤‡∏ô ‚Üí currentStep = Warehouse ‚Üí Production ‡∏Å‡∏•‡∏±‡∏ö‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏ó‡∏≤
        if (
          currentStep === "Warehouse" &&
          status.qc_inspection === "‡∏ï‡∏£‡∏ß‡∏à‡πÑ‡∏°‡πà‡∏ú‡πà‡∏≤‡∏ô"
        ) {
          return "#e5e7eb";
        }

        return "#e5e7eb";

      case "QC":
        if (
          status.qc_inspection === "‡∏ï‡∏£‡∏ß‡∏à‡∏ú‡πà‡∏≤‡∏ô‡πÅ‡∏•‡πâ‡∏ß" &&
          status.qc_coa === "‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÅ‡∏•‡πâ‡∏ß"
        ) {
          return "#4ade80";
        }

        if (
          ["‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏£‡∏ß‡∏à (‡∏£‡∏≠‡∏õ‡∏£‡∏±‡∏ö)", "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏£‡∏ß‡∏à (Hold)"].includes(
            status.qc_inspection
          ) ||
          ["‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°"].includes(status.qc_coa)
        ) {
          return "#facc15";
        }

        return "#e5e7eb";

      case "Account":
        if (status.account === "Invoice ‡∏≠‡∏≠‡∏Å‡πÅ‡∏•‡πâ‡∏ß") return "#4ade80";
        if (status.account === "Invoice ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏≠‡∏≠‡∏Å") return "#facc15";
        return "#e5e7eb";

      default:
        return "#e5e7eb";
    }
  };

  return (
    <div className="progress-table-wrapper">
      <table className="progress-table">
        <thead>
          <tr>
            <th>Product</th>
            {steps.map((step) => (
              <th key={step}>{step}</th>
            ))}
          </tr>
        </thead>
        <tbody>
          {[...jobs]
            .sort((a, b) => (a.product_name || "").localeCompare(b.product_name || ""))
            .map((job) => (
              <tr key={job.id}>
                <td>
                  <span className="product-label">
                    <span role="img" aria-label="doc">
                      üìÑ
                    </span>{" "}
                    {job.product_name}
                  </span>
                </td>
                {steps.map((step) => (
                  <td key={step}>
                    <div
                      style={{
                        backgroundColor: getStatusColor(step, job),
                        height: "20px",
                        width: "100px",
                        maxWidth: "100px",
                        borderRadius: "6px",
                        margin: "auto",
                      }}
                    ></div>
                  </td>
                ))}
              </tr>
            ))}
        </tbody>
      </table>
    </div>
  );
}
